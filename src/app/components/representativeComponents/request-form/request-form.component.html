<section class="dark:bg-gray-900 pt-2 requistForm mx-auto" dir="rtl">
    <div class="py-8 px-4 mx-auto  lg:py-16 form">
        <div class="flex">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                <!-- <path d="M16.5 6a3 3 0 00-3-3H6a3 3 0 00-3 3v7.5a3 3 0 003 3v-6A4.5 4.5 0 0110.5 6h6z" /> -->
                <path d="M18 7.5a3 3 0 013 3V18a3 3 0 01-3 3h-7.5a3 3 0 01-3-3v-7.5a3 3 0 013-3H18z" />
            </svg>
            <h2 class="mb-4 text-xl font-bold text-gray-900 dark:text-white">
                طلب عرض سعر
            </h2>
        </div>

        <div class="container" dir="rtl">
            <span class="text-behind">بيانات العميل</span>
            <hr />
        </div>
        <form class="" [formGroup]="ReqForm">
            <div class="grid gap-4 sm:grid-cols-2 sm:gap-6 mb-8">
                <div class="grid gap-4 sm:grid-cols-1 sm:gap-6">
                    <div class="sm:col-span-2">
                        <label for="name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">اسم
                            النشاط <span class="text-red-500">*</span></label>
                        <input type="text" name="name" id="name" formControlName="ActivityName"
                            class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            placeholder="" required="" />
                        <div class="alert text-red-500" [hidden]="ActivityName?.valid || ActivityName?.untouched">
                            <small *ngIf="ActivityName?.errors?.['required']">اسم النشاط مطلوب
                            </small>
                        </div>
                    </div>
                    <div class="sm:col-span-2">
                        <label for="name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">طبيعة
                            النشاط <span class="text-red-500">*</span></label>
                        <input type="text" name="name" id="name" formControlName="ActivityNature"
                            class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            placeholder="" required="" />
                        <div class="alert text-red-500" [hidden]="ActivityNature?.valid || ActivityNature?.untouched">
                            <small *ngIf="ActivityNature?.errors?.['required']">اسم النشاط مطلوب</small>
                        </div>
                    </div>
                    <div class="w-full">
                        <label for="brand" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">عنوان
                            النشاط <span class="text-red-500">*</span></label>
                        <input type="text" name="brand" id="brand" formControlName="activityLocation"
                            class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            placeholder="" required="" />
                        <div class="alert text-red-500"
                            [hidden]="activityLocation?.valid || activityLocation?.untouched">
                            <small *ngIf="activityLocation?.errors?.['required']">عنوان النشاط مطلوب</small>
                        </div>
                    </div>
                    <div class="w-full">
                        <label for="price" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">الدولة
                            <span class="text-red-500">*</span></label>
                        <!-- <input type="text" name="price" id="price" formControlName="Country"
                            class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            placeholder="" required="" /> -->
                        <p-dropdown class="w-full " [options]="countries" id="country" optionLabel="name"
                            formControlName="Country" [autoDisplayFirst]="false" placeholder="select country"
                            optionValue="_id"></p-dropdown>
                        <div class="alert text-red-500" [hidden]="Country?.valid || Country?.untouched">
                            <small *ngIf="Country?.errors?.['required']">اسم الدولة مطلوب</small>
                        </div>
                    </div>
                    <div class="sm:col-span-2">
                        <label for="name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">المحافظة
                            <span class="text-red-500">*</span></label>
                        <input type="text" name="name" id="name" formControlName="Governorate"
                            class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            placeholder="" required="" />
                        <div class="alert text-red-500" [hidden]="Governorate?.valid || Governorate?.untouched">
                            <small *ngIf="Governorate?.errors?.['required']">اسم المحافظة مطلوب
                            </small>
                        </div>
                    </div>

                    <div>
                        <label for="item-weight"
                            class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">المدينة <span
                                class="text-red-500">*</span></label>
                        <input type="text" name="item-weight" id="item-weight" formControlName="City"
                            class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            placeholder="" required="" />
                        <div class="alert text-red-500" [hidden]="City?.valid || City?.untouched">
                            <small *ngIf="City?.errors?.['required']">المدينة مطلوبة</small>
                        </div>
                    </div>
                </div>

                <div class="grid gap-4 sm:grid-cols-1 sm:gap-6">
                    <!-- <hr class="clientInfo invisible"> -->
                    <div class="sm:col-span-2">
                        <label for="name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">اسم صاحب
                            النشاط <span class="text-red-500">*</span></label>
                        <input type="text" name="name" id="name" formControlName="Name"
                            class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            placeholder="" required />
                        <div class="alert text-red-500" [hidden]="Name?.valid || Name?.untouched">
                            <small *ngIf="Name?.errors?.['required']">اسم العميل مطلوب
                            </small>
                        </div>
                    </div>
                    <div class="sm:col-span-2">
                        <label for="name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">رقم
                            الموبايل <span class="text-red-500">*</span></label>
                        <input type="text" name="name" id="name" formControlName="Mobile"
                            class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            placeholder="" required="" />
                        <div class="alert text-red-500" [hidden]="Mobile?.valid || Mobile?.untouched">
                            <small *ngIf="Mobile?.errors?.['required']">رقم الموبايل مطلوب
                            </small>
                        </div>
                    </div>
                    <div class="sm:col-span-2">
                        <label for="name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">رقم
                            الهاتف
                        </label>
                        <input type="text" name="name" id="name" formControlName="Phone"
                            class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            placeholder="" />
                    </div>
                    <div class="sm:col-span-2">
                        <label for="name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">البريد
                            الالكتروني
                        </label>
                        <input type="text" name="name" id="name" formControlName="Email"
                            class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            placeholder="" />
                    </div>
                    <div class="sm:col-span-2">
                        <label for="name"
                            class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">العنوان</label>
                        <input type="text" name="name" id="name"
                            class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            placeholder="" />
                    </div>
                    <div class="sm:col-span-2"></div>
                </div>
                <!-- <div class="sm:col-span-2">
                    <label for="description" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Description</label>
                    <textarea id="description" rows="8" class="block p-2.5 w-full text-sm text-gray-900 bg-white rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="Your description here"></textarea>
                </div> -->
            </div>

            <!-- another table  -->
            <!-- <div class="container mx-auto sm:px-8">
                <div class="py-8">
                    <div class="inline-block w-full shadow-md rounded-lg overflow-x-auto">
                        <table class="w-full leading-normal" dir="rtl">
                            <thead class="text-center">
                                <tr class="">
                                    <th
                                        class="text-center w-1/3 py-3 border-b-2 border-gray-200 registerBtn text-left text-xs font-semibold uppercase tracking-wider">
                                        اسم النظام/الخدمات
                                    </th>
                                    <th
                                        class="text-center w-1/3 py-3 border-b-2 border-gray-200 registerBtn text-left text-xs font-semibold uppercase tracking-wider">
                                        بيان الأجهزة
                                    </th>
                                    <th
                                        class="text-center w-1/3 py-3 border-b-2 border-gray-200 registerBtn text-left text-xs font-semibold uppercase tracking-wider">
                                        ملاحظات
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="text-right" formArrayName="Services">
                                <tr class="address-container" *ngFor="
                    let group of Services.controls;
                    let serviceIndex = index
                  " [formGroupName]="serviceIndex">
                                    <td class="px-1 py-5 border-b border-gray-200 bg-white text-sm">
                                        <div>
                                            <select id="category" dir="rtl" formControlName="Service"
                                                placeholder="Example placeholder"
                                                class="block py-2.5 px-0 w-full text-sm text-black bg-transparent border-0 appearance-none dark:text-gray-400 dark:border-gray-700 focus:outline-none focus:ring-0 focus:border-gray-200 peer">
                                                <option *ngFor="let service of services" [ngValue]="service._id">
                                                    {{ service.Name }}
                                                </option>
                                            </select>
                                        </div>
                                    </td>
                                    <td class="px-1 py-2 border-b border-gray-200 bg-white text-sm">
                                        <div formArrayName="Devices">
                                            <div class="mb-1 ms-4" *ngFor="
                          let skill of DeviceOffer(serviceIndex).controls;
                          let j = index 
                        " [formGroupName]="j">-->
            <!-- <label for=" usrMobile{{skillIndex}}" class="form-label">جهاز
                                                رقم{{skillIndex}}:</label> -->
            <!-- <span
                                                    class="servicesInput inline-block my-2 font-semibold text-green-900 leading-tight">
                                                    <input type="string"
                                                        class="focus:outline-none servicesInput p-1 inset-0 bg-green-200 opacity-50 rounded-full form-control"
                                                        name="Service{{ serviceIndex + 1 }}"
                                                        id="Service{{ serviceIndex + 1 }}" formControlName="Quantity" />
                                                </span>
                                            </div>
                                        </div> -->
            <!-- <button
                                            class="text-yellow-500 text-center bg-gray-800 hover:bg-gray-900 focus:outline-none focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm   px-8 m-auto mb-2 dark:bg-gray-800 dark:hover:bg-gray-700 dark:focus:ring-gray-700 dark:border-gray-700"
                                            (click)="addDeviceInp(serviceIndex)">+</button> -->
            <!-- </td>
                                    <td class="px-1 h-full border-b border-gray-200 bg-white text-sm">
                                        <textarea formControlName="Notes" id="description"
                                            class="block p-2.5 w-full h-full resize-y appearance-none focus:outline-none text-sm text-gray-900 bg-white rounded-lg border border-gray-300 focus:ring-green-300 focus:border-green-300 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                            placeholder="سجل ملاحظاتك"></textarea>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="form-row org-desc-parent-margin text-center p-1">
                            <button mat-raised-button class="service rounded-lg p-1" (click)="addService()">
                                اضافة خدمة اخري
                            </button>
                        </div>
                    </div>
                </div>
            </div> -->

            <!-- service form  -->
            <div class="flex justify-right mb-2">
                <h3 class="rounded-lg p-2 bg-black text-yellow-300 hover:bg-yellow-300 hover:text-black">اضافة الخدمات
                </h3>
            </div>
            <div class="bg-white p-2 pt-5 shadow-lg mb-8" dir="rtl">

                <div formArrayName="Services" class="">

                    <div class="flex grid grid-cols-6 border border-gray-400"
                        *ngFor="let group of Services?.controls; let serviceIndex = index"
                        [formGroupName]="serviceIndex">
                        <div class="flex col-span-6 justify-end align"><p-button icon="pi pi-times"
                                (onClick)="deleteService(serviceIndex)"
                                styleClass="p-button-rounded p-button-danger p-button-text"></p-button>
                        </div>
                        <div class="lg:col-span-3 col-span-6">
                            <div class="w-100 p-2 m-3">
                                <label for="category">اختر الخدمة</label>
                                <select id="category" dir="rtl" name="selectedValue" formControlName="Service"
                                    (change)="SelectedService($event, serviceIndex)"
                                    class="block py-2.5 px-0 w-full text-sm text-black bg-transparent appearance-none dark:text-gray-400 border-gray-300 focus:outline-none focus:ring-0 focus:border-gray-200 peer">
                                    <option selected>اختر الخدمة</option>
                                    <option *ngFor="let service of services" value="{{ service._id }}">
                                        {{ service?.Name }}
                                    </option>
                                </select>
                                <ul class="max-w-md space-y-1 text-gray-500 list-inside dark:text-gray-400">
                                    <li class="flex items-center"
                                        *ngFor="let detail of selectedValues[serviceIndex]?.Details">
                                        <svg class="w-3.5 h-3.5 mr-2 text-green-500 dark:text-green-400 flex-shrink-0 mx-2"
                                            aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                                            viewBox="0 0 20 20">
                                            <path
                                                d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 8.207-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L9 10.586l3.293-3.293a1 1 0 0 1 1.414 1.414Z" />
                                        </svg>
                                        {{ detail }}
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="lg:col-span-3 col-span-6 p-2 m-3 bg-yellow">
                            <label for="selectedValue"> الاجهزة</label>
                            <select dir="rtl" placeholder="Example placeholder" name="selectedValue" id="selectedValue"
                                (change)="SelectedDevicesPrice($event, serviceIndex)"
                                class="form-select appearance-none block  px-0 w-full text-sm text-black bg-transparent appearance-none dark:text-gray-400 border-gray-300 focus:outline-none focus:ring-0 focus:border-gray-200 peer">
                                <option value="0 " selected>اختر الاجهزة</option>
                                <option *ngFor="let device of selectedValues[serviceIndex]?.Devices"
                                    value="{{device._id}}">
                                    {{ device.Title }}
                                </option>
                            </select>
                            <div>
                                <ul>
                                    <div formArrayName="Devices">
                                        <div class="mb-1  bg-green-100" *ngFor=" let skill of DeviceOffer(serviceIndex).controls; let j = index
                                            " [formGroupName]="j">
                                            <!-- <label for=" usrMobile{{skillIndex}}" class="form-label">جهاز
                                            رقم{{skillIndex}}:</label> -->
                                            <span
                                                class="servicesInput inline-block my-2 font-semibold text-green-900 leading-tight">
                                                <div class="grid grid-cols-8">
                                                    <div class="col-span-6 flex justify-content-center">
                                                        <span class="m-2">{{SelectedDevices[serviceIndex][j]?.Title
                                                            }}</span>
                                                    </div>
                                                    <span class="col-span-7 items-center flex">
                                                        <i class="mx-2 mb-2 pi pi-desktop" style="color:blue"></i>
                                                        <input type="number" (input)="calculateServiceSubTotal()"
                                                            placeholder=" ادخل عدد الاجهزة..."
                                                            class="ng-invalid ng-dirty bg-white  border border-gray-200 text-gray-900 text-sm focus:border-primary-300 block   dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                                            name="Service{{ serviceIndex + 1 }}"
                                                            id="Service{{ serviceIndex + 1 }}"
                                                            formControlName="Quantity" />
                                                        <span class="text-red-600 mb-5">*</span>

                                                    </span>


                                                    <div class="col-span-1 flex">

                                                        <p-button icon="pi pi-times"
                                                            (onClick)="deleteDevice(serviceIndex,j)"
                                                            styleClass="p-button-rounded p-button-danger p-button-text"></p-button>
                                                    </div>
                                                    <div class="alert text-red-500 col-span-7"
                                                        [hidden]="DeviceOffer(serviceIndex).controls[j].get('Quantity')?.valid ||DeviceOffer(serviceIndex).controls[j].get('Quantity')?.untouched ">
                                                        <small
                                                            *ngIf="DeviceOffer(serviceIndex).controls[j].get('Quantity')?.errors?.['required']">
                                                            عدد الاجهزة مطلوب </small>
                                                    </div>

                                                    <p-messages></p-messages>
                                                </div>
                                            </span>
                                        </div>
                                    </div>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-row org-desc-parent-margin text-center p-1 ">
                    <button mat-raised-button class="service rounded-lg p-1 m-3 " (click)="addService()">
                        اضافة خدمة اخري
                    </button>
                </div>
                <div class=" text-black sm:gap-6 mb-8  p-8  grid grid-cols-2">
                    <div class="lg:col-span-1 col-span-2">
                        <label for="name" class="block mb-2 text-sm font-medium  dark:text-white">
                            عددالفروع <span class="text-red-500">*</span></label>
                        <input type="number" name="name" id="name" formControlName="BranchesNumber"
                            class="bg-gray-300 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            placeholder="" required="" />
                        <div class="alert text-red-500" [hidden]="BranchesNumber?.valid || BranchesNumber?.untouched">
                            <small *ngIf="BranchesNumber?.errors?.['required']"> عددالفروع مطلوب
                            </small>
                        </div>
                    </div>
                    <div class="lg:col-span-1 col-span-2">
                        <label for="name" class="block mb-2 text-sm font-medium  dark:text-white">خطة
                            الدفع <span class="text-red-500">*</span></label>
                        <select dir="rtl" placeholder="Example placeholder" formControlName="PaymentPlan"
                            name="selectedValue" id="selectedValue"
                            class="rounded bg-gray-300 block py-2.5 px-0 w-full text-sm text-black bg-transparent appearance-none dark:text-gray-400 border-gray-300 focus:outline-none focus:ring-0 focus:border-gray-200 peer">
                            <option disabled selected>اختر خطة الدفع</option>
                            <option class="bg-white" *ngFor="let plan of PaymentPlans" value="{{ plan._id }}">
                                {{ plan.Plan }}
                            </option>
                        </select>
                    </div>
                    <div class=" col-span-2">
                        <label for="name" class="block mb-2 text-sm font-medium  dark:text-white">
                            الملاحظات </label>
                        <textarea name="name" id="name" formControlName="Notes"
                            class="bg-gray-300 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                            placeholder=""></textarea>

                    </div>

                </div>
                <div class="flex justify-center mt-8">
                    <button (click)="AddPriceoffer(false)" type="submit"
                        class="mx-8 w-50 text-white bg-green-600 hover:bg-primary-700 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-1.5 text-center dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800">
                        حفظ الطلب
                    </button>
                    <button (click)="AddPriceoffer(true)" type="submit" [disabled]="ReqForm.invalid"
                        class="registerBtn mx-8 w-50 text-warning bg-dark hover:bg-primary-700 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-1.5 text-center dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800">
                        حفظ وارسال
                    </button>
                </div>
            </div>


        </form>
        <!-- {{ ReqForm.errors }}
        {{ ReqForm.value | json }} -->
    </div>
</section>
<!-- Component Start  -->